# Plan de Trabajo Semestral: Infraestructura Lidsol (Enero - Junio 2026)

**Objetivo General:** Estabilizar la infraestructura crítica (red y cluster), resolver la deuda técnica acumulada e implementar un sistema de monitoreo robusto, sentando las bases para la expansión de servicios mediante identidad centralizada y documentación rigurosa.

---

## Eje 1: Estabilización y Seguridad (Meses 1-2)
*Enfoque: Recuperación de servicios críticos, "apagar fuegos" y asegurar el perímetro.*

### 1.1 Recuperación del Cluster Kubernetes (Prioridad Crítica) **Quique y Diego C.**
El cluster se encuentra en estado degradado tras la pérdida del nodo beta.
* **Diagnóstico de Hardware:** Evaluar si el nodo beta requiere sustitución de disco (propuesta previa de Quique) o reparación mayor.
* **Restauración de HA:** Reintegrar el nodo al cluster para recuperar la Alta Disponibilidad.
* **Optimización de Longhorn:** Reconfigurar la replicación de volúmenes para reducir la carga de I/O en los discos más antiguos, mitigando los problemas de sincronización reportados.

### 1.2 Red y Conectividad (Máquina Mirrors/Tor) **Quique y Luis S.**
Solucionar la intermitencia que afecta la disponibilidad de los espejos públicos.
* **Auditoría de Red:** Revisar logs del sistema (`dmesg`, `journalctl`) en busca de saturación de interfaz o fallos de hardware.
* **QoS en Nodo Tor:** Implementar límites de ancho de banda (Traffic Shaping) para el nodo Tor, asegurando que no consuma el 100% del enlace y permita el tráfico fluido a los mirrors.
* **Evidencia para ISP:** Utilizar el servidor de Speedtest implementado previamente para recolectar métricas de caídas y reportar al proveedor si es falla externa.

### 1.3 Auditoría de Seguridad (Nueva Iniciativa) 
Aprovechar la revisión de infraestructura para endurecer la seguridad.
* **Escaneo de Vulnerabilidades:** Ejecutar análisis de puertos y servicios expuestos en la IP pública y nodos internos.
* **Revisión de Accesos:** Auditar llaves SSH y permisos de usuarios en los servidores (limpieza de accesos antiguos).
* **Actualización de Dependencias:** Parcheo de servicios críticos (siguiendo la línea de trabajo de Quique con Apache Beam).

### 1.4 Consolidación de Mirrors **Mau, Christian F. y Brent**
* **Fedora:** Enviar correo de confirmación a `fedora.org` (sync completado en dic-2025).
* **Rocky Linux:** Finalizar configuración de sincronización y automatización.

---

## Eje 2: Observabilidad y Monitoreo (Meses 2-3)
*Enfoque: Visibilidad total. Pasar de "investigar" a "implementar".*

### 2.1 Stack de Métricas (Prometheus + Grafana)
Consolidar el trabajo iniciado por Luis S. y Quique.
* **Infraestructura de Recolección:** Despliegue de `node_exporter` en todos los nodos (físicos y virtuales).
* **Prometheus Central:** Configuración final del servicio para *scrapeo* de métricas del cluster y mirrors.
* **Dashboards:** Finalizar la integración en Grafana para visualizar CPU, RAM, I/O de disco y estado de red.
* **Sistema de Alertas:** Configurar notificaciones (Telegram/Slack/Email) para eventos críticos:
    * Nodo caído (Ping check).
    * Almacenamiento crítico (Disco > 90%).

### 2.2 Centralización de Logs
* **Decisión Técnica:** Definir entre Elastic Search (investigado por Javier) o Loki (más ligero para K3s).
* **Ingesta:** Centralizar logs de sistema y logs de acceso de los servidores web (Nginx/Apache) de los mirrors.

---

## Eje 3: Almacenamiento y Gestión de Datos (Meses 3-4)
*Enfoque: Integridad de datos y recuperación ante desastres.*

### 3.1 "El Búnker" (Nodo de Almacenamiento)
Ejecutar el diseño de respaldo propuesto por Diego.
* **Configuración Base:** Implementar sistema de archivos BTRFS en RAID1 para garantizar integridad de datos.
* **Servicios:** Desplegar `restic-server` como repositorio central de backups.
* **Desacoplamiento:** Migrar bases de datos pesadas o históricas fuera del cluster K3s hacia este nodo.

### 3.2 Estrategia de Backups Automatizados
* **Pipeline de Respaldo:** Configurar cronjobs para snapshots de Longhorn + Restic hacia el nodo de almacenamiento.
* **Pruebas de Recuperación:** Realizar simulacro de restauración de un volumen para validar la estrategia.

---

## Eje 4: Cultura, Documentación y Expansión (Meses 5-6)
*Enfoque: Organización interna y preparación para el futuro.*

### 4.1 Gestión del Conocimiento (Wiki)
Formalizar la solicitud de subdominio `wiki.lidsol.unam.mx`.
* **Despliegue:** Poner en producción Wiki.js (o la solución elegida).
* **Migración de Documentación:**
    * Trasladar minutas históricas.
    * Crear guías de "Disaster Recovery" para el cluster.
    * Documentar procesos de alta de nuevos mirrors.
* **Política:** Establecer como requisito que todo nuevo despliegue incluya su entrada en la Wiki.

### 4.2 Identidad Centralizada (Nueva Iniciativa)
Resolver la fragmentación de usuarios entre servicios.
* **Implementación SSO:** Desplegar **Keycloak** o **Authentik** en el cluster.
* **Integración:** Conectar Grafana, ArgoCD, Wiki y servicios internos al proveedor de identidad.
* **Beneficio:** Gestión centralizada de altas y bajas de miembros del laboratorio.

---

## Cronograma Resumido

| Mes | Foco Principal | Hitos Clave | Responsables Sugeridos |
| :--- | :--- | :--- | :--- |
| **1** | **Rescate** | Nodo Beta online. QoS en Tor. Auditoría de Seguridad inicial. | Quique, Diego, Mau |
| **2** | **Mirrors & Red** | Mirrors Fedora/Rocky oficiales. Reporte de red a ISP. | Mau, Sandra, Luis |
| **3** | **Monitoreo** | Prometheus + Grafana productivos. Alertas activas. | Luis S., Quique |
| **4** | **Storage** | Nodo Storage (Btrfs/Raid1). Backups Restic automatizados. | Diego, Javier |
| **5** | **Wiki** | Wiki online. Documentación técnica migrada. | David E.C., Todos |
| **6** | **Identidad** | SSO (Keycloak) integrado. Evaluación semestral. | Todos |